---
layout: post
tags: docker docker-compose
---

리눅스에서 서버를 실행시키는데 이때까지 쉘스크립트를 이용해서 서버를 실행했다 지금은 로컬 서버에서 해서 버전이나 업데이트 이부분에서 문제가 없지만 클라우드로 옮길때 버전 문제 운영체제 문제등이 존재하기 때문에 도커와 도커 컴포즈로 변경할려고 한다

### 도커

도커는 `dockerfile`로 작성하고 확장자는 없다 도커 파일은 이미지를 빌드(만들때) 사용하는 파일로 도커 파일을 실행하면 이미지가 생성되고 실행된다

``` plaintext
docker-example/
│── main.py
│── requirements.txt
│── Dockerfile
```

``` dockerfile
# Python 3.9 기반의 슬림 이미지를 사용합니다.
FROM python:3.9-slim

# 작업 디렉토리 생성 및 설정
WORKDIR /app

# 의존성 파일 복사 및 설치
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# 애플리케이션 코드 복사 로컬에 있는 파일 복사
COPY . .

# 컨테이너 시작 시 uvicorn으로 FastAPI 앱 실행 (main.py의 app 객체를 실행)
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]

```

위 코드는 도커를 이용해서 fastapi를 실행하는 도커코드이다

&nbsp;

#### 도커 build 명령어

``` sh
docker build -t my-app:v1 .
```

이 명령어는 현재 위치 기반(.)에 있는 dockerfile로 빌드를 하는데 태그 (-t) 이름 my-app으로 설정하고 : v1으로 버전을 명시한다 만약 버전 표기가 없다면 lastest로 자동으로 된다

&nbsp;

#### 도커 run 명령어

``` sh
docker run -p 3000:3000 my-app
```

my-app이라는 이름의 도커 이미지를 기반으로 컨테이너를 실행하는 명령어이다 -p 는 호스트포트: 컨테이터 포트를 의미한다

##### 주요옵션

| 옵션                                 | 설명                                           |
| ------------------------------------ | ---------------------------------------------- |
| `-p 호스트포트:컨테이너포트`         | 호스트와 컨테이너 간의 포트 매핑 (`3000:3000`) |
| `-d`                                 | 컨테이너를 백그라운드에서 실행 (Detached mode) |
| `-it`                                | 인터랙티브 모드 (`-i` + `-t` 조합)             |
| `--name`                             | 컨테이너 이름을 지정                           |
| `--rm`                               | 컨테이너 종료 시 자동 삭제                     |
| `-v 호스트디렉토리:컨테이너디렉토리` | 볼륨 마운트 (파일을 공유)                      |
| `-e KEY=VALUE`                       | 환경 변수 설정                                 |

&nbsp;

#### 실행후 컨테이너 관리

``` sh
docker ps          # 실행 중인 컨테이너 목록 확인
docker ps -a       # 중지된 컨테이너 포함 전체 목록 확인
docker stop <ID>   # 특정 컨테이너 중지
docker rm <ID>     # 특정 컨테이너 삭제
docker images      # 저장된 도커 이미지 목록 확인
docker rmi <IMAGE> # 특정 도커 이미지 삭제
```

``` sh
docker stop $(docker ps -q)   # 모든 실행 중인 컨테이너 중지
docker rm $(docker ps -aq)    # 모든 컨테이너 삭제
docker rmi $(docker images -q) # 모든 이미지 삭제
```

도커 어플리케이션으로도 관리가 가능하다

&nbsp;

