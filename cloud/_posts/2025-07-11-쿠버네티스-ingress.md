---
layout: post
title: ì¿ ë²„ë„¤í‹°ìŠ¤ Ingress ì‹¤ìŠµ
tags: kubernetses ingress
image: 'https://image.minnnning.kr/images/a80b69dd-1044-423b-860f-55ffa0d38d72.webp'
mermaid: true
---

## ì¸ê·¸ë ˆìŠ¤ì˜ í•µì‹¬ êµ¬ì¡°: ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë¦¬ì†ŒìŠ¤

ì¸ê·¸ë ˆìŠ¤ëŠ” ë°˜ë“œì‹œ **ë‘ ê°€ì§€ í•µì‹¬ ìš”ì†Œ**ê°€ í•¨ê»˜ ìˆì–´ì•¼ ë™ì‘í•œë‹¤

1. **ì¸ê·¸ë ˆìŠ¤ ì»¨íŠ¸ë¡¤ëŸ¬ (Ingress Controller) ğŸ§‘â€ğŸ³**
   - **ì—­í• **: ì‹¤ì œ íŠ¸ë˜í”½ì„ ë°›ê³  ê·œì¹™ì— ë”°ë¼ ìš”ì²­ì„ ë¶„ë°°í•˜ëŠ” **ì‹¤í–‰ê¸°(ì—”ì§„)** Nginx, Traefik, HAProxy ë“± ë‹¤ì–‘í•œ ì¢…ë¥˜ê°€ ìˆìœ¼ë©°, í´ëŸ¬ìŠ¤í„°ì— ë°˜ë“œì‹œ **í•˜ë‚˜ ì´ìƒ ì„¤ì¹˜ë˜ì–´ ìˆì–´ì•¼ í•œë‹¤**
   - **ë¹„ìœ **: ë ˆì‹œí”¼ë¥¼ ë³´ê³  ì‹¤ì œë¡œ ìš”ë¦¬ë¥¼ í•˜ëŠ” **'ì…°í”„'**
2. **ì¸ê·¸ë ˆìŠ¤ ë¦¬ì†ŒìŠ¤ (Ingress Resource) ğŸ“œ**
   - **ì—­í• **: ì‚¬ìš©ìê°€ YAML íŒŒì¼ë¡œ ì‘ì„±í•˜ëŠ” **ë¼ìš°íŒ… ê·œì¹™ì„œ** "ì–´ë–¤ ë„ë©”ì¸ìœ¼ë¡œ ìš”ì²­ì´ ì˜¤ë©´ ì–´ë–¤ ì„œë¹„ìŠ¤ë¡œ ë³´ë‚´ë¼"ëŠ” ë‚´ìš©ì´ ë‹´ê²¨ìˆë‹¤
   - **ë¹„ìœ **: ì…°í”„ê°€ ë”°ë¼ì•¼ í•  **'ë ˆì‹œí”¼'**

&nbsp;

## ìµœì¢… ëª©í‘œ

 ì™¸ë¶€ ì¸í„°ë„· ë¸Œë¼ìš°ì €ì—ì„œ `http://hello.example.com` ì´ë¼ëŠ” ê°€ìƒ ë„ë©”ì¸ìœ¼ë¡œ ì ‘ì†í–ˆì„ ë•Œ, ìš°ë¦¬ê°€ ë§Œë“  ê°„ë‹¨í•œ HTML ì›¹ í˜ì´ì§€ê°€ ë³´ì´ë„ë¡ ë§Œë“œëŠ” ê²ƒ

``` mermaid
graph TD
    subgraph "ğŸ’» ì‚¬ìš©ì PC"
        A["ğŸŒ ì‚¬ìš©ì<br>ì›¹ ë¸Œë¼ìš°ì €"] -->|"hello.example.com ìš”ì²­"| B["ğŸ“„ ë¡œì»¬<br>/etc/hosts íŒŒì¼"];
        B -->|"ì›Œì»¤ ë…¸ë“œ IP ì£¼ì†Œ ë°˜í™˜"| A;
    end

    subgraph "ğŸ¢ ì¿ ë²„ë„¤í‹°ìŠ¤ í´ëŸ¬ìŠ¤í„°"
        C["ğŸŒ NodePort Service<br>(Ingress Controller)"] -->|íŠ¸ë˜í”½ ì „ë‹¬| D["ğŸ‘®â€ Ingress Controller<br>Pod"];
        D -->|"Ingress ê·œì¹™ ì¡°íšŒ"| E["ğŸ“œ Ingress ë¦¬ì†ŒìŠ¤"];
        E -->|"ì„œë¹„ìŠ¤ë¡œ ë¼ìš°íŒ…"| F["ğŸŒ my-web-service<br>(ClusterIP)"];
        F -->|"ë¡œë“œ ë°¸ëŸ°ì‹±"| G["ğŸ“¦ NGINX Pod 1"];
        F -->|"ë¡œë“œ ë°¸ëŸ°ì‹±"| H["ğŸ“¦ NGINX Pod 2"];
    end

    A -->|"HTTP ìš”ì²­ ì „ì†¡<br>To: ì›Œì»¤ ë…¸ë“œ IP"| C;

    style A fill:#f9f,stroke:#333
    style C fill:#bbf,stroke:#333
    style E fill:#9f9,stroke:#333
```

&nbsp;

## 1. ì›¹ í˜ì´ì§€ ë§Œë“¤ê¸° (ConfigMap)

ë¨¼ì €, ì›¹ ì„œë²„ê°€ ë³´ì—¬ì¤„ ê°„ë‹¨í•œ HTML íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤ ë³„ë„ì˜ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì§€ ì•Šê³ , `ConfigMap`ì„ ì‚¬ìš©í•˜ì—¬ HTML ì½”ë“œë¥¼ í´ëŸ¬ìŠ¤í„°ì— ì§ì ‘ ì €ì¥í•˜ëŠ” ë°©ì‹ì„ ì‚¬ìš©

- **ëª…ë ¹ì–´ì˜ ì—­í• :** ì•„ë˜ YAML íŒŒì¼ì€ `my-html`ì´ë¼ëŠ” ì´ë¦„ì˜ `ConfigMap`ì„ ìƒì„± ì´ `ConfigMap`ì€ `index.html`ì´ë¼ëŠ” í‚¤(key)ì— ìš°ë¦¬ê°€ ì›í•˜ëŠ” HTML ì½”ë“œë¥¼ ê°’(value)ìœ¼ë¡œ ì €ì¥
- **`web-configmap.yaml` íŒŒì¼ ì‘ì„±:** ì•„ë˜ ë‚´ìš©ìœ¼ë¡œ YAML íŒŒì¼ì„ ìƒì„±

``` yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: my-html
data:
  index.html: |
    <!DOCTYPE html>
    <html>
    <head>
      <title>Welcome to Kubernetes Ingress!</title>
      <style>
        body { font-family: sans-serif; text-align: center; margin-top: 100px; background-color: #f0f8ff; }
        h1 { color: #005a9c; }
        p { font-size: 1.2em; }
      </style>
    </head>
    <body>
      <h1>hello</h1>
      <p>success connecting!</p>
    </body>
    </html>
```

- **íŒŒì¼ ì ìš©:**

```bash
kubectl apply -f web-configmap.yaml
```

&nbsp;

### 2. ì›¹ ì„œë²„ ë„ìš°ê¸° (Deployment)

ì´ì œ ìœ„ì—ì„œ ë§Œë“  HTML íŒŒì¼ì„ ì„œë¹™í•  NGINX ì›¹ ì„œë²„ë¥¼ `Deployment`ë¥¼ í†µí•´ ìƒì„±í•œë‹¤.

- **ëª…ë ¹ì–´ì˜ ì—­í• :** `my-web-deployment`ë¼ëŠ” ì´ë¦„ì˜ `Deployment`ë¥¼ ìƒì„± ì´ `Deployment`ëŠ” NGINX ì»¨í…Œì´ë„ˆë¥¼ ì‹¤í–‰í•˜ë©°, 1ë‹¨ê³„ì—ì„œ ë§Œë“  `ConfigMap`ì„ ë³¼ë¥¨(Volume)ìœ¼ë¡œ ë§ˆìš´íŠ¸í•˜ì—¬ NGINXì˜ ê¸°ë³¸ ì›¹ í˜ì´ì§€ ê²½ë¡œ(`/usr/share/nginx/html`)ì— ë®ì–´ì”Œìš´ë‹¤
- **`web-deployment.yaml` íŒŒì¼ ì‘ì„±:**

``` yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-web-deployment
spec:
  replicas: 2 # ì•ˆì •ì„±ì„ ìœ„í•´ 2ê°œì˜ Podì„ ì‹¤í–‰í•©ë‹ˆë‹¤.
  selector:
    matchLabels:
      app: my-web
  template:
    metadata:
      labels:
        app: my-web
    spec:
      containers:
      - name: nginx
        image: nginx:latest
        ports:
        - containerPort: 80
        volumeMounts: # ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì— ë³¼ë¥¨ì„ ì—°ê²°(ë§ˆìš´íŠ¸)í•©ë‹ˆë‹¤.
        - name: html-volume
          mountPath: /usr/share/nginx/html
      volumes: # Podì´ ì‚¬ìš©í•  ë³¼ë¥¨ì„ ì •ì˜í•©ë‹ˆë‹¤.
      - name: html-volume
        configMap:
          name: my-html # 'my-html' ConfigMapì„ ë³¼ë¥¨ìœ¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
```

- íŒŒì¼ ì ìš©:

```bash
kubectl apply -f web-deployment.yaml
```

<center><img src="https://image.minnnning.kr/images/e60e037a-2934-4703-a679-11c28a1b4f0d.webp" style="zoom:50%;"></center>

&nbsp;

### 3. ë‚´ë¶€ ì£¼ì†Œ ë¶€ì—¬í•˜ê¸° (Service)

`Deployment`ì˜ Podë“¤ì€ ì–¸ì œë“  ì£½ê³  ìƒˆë¡œ ìƒì„±ë  ìˆ˜ ìˆì–´ì„œ IPê°€ ê³„ì† ë°”ë€œ ë”°ë¼ì„œ Ingressê°€ ì•ˆì •ì ìœ¼ë¡œ ì°¾ì•„ê°ˆ ìˆ˜ ìˆë„ë¡ ê³ ì •ëœ ë‚´ë¶€ ì£¼ì†Œë¥¼ ê°€ì§„ `Service`ë¥¼ ìƒì„±í•´ì•¼ í•œë‹¤

- **ëª…ë ¹ì–´ì˜ ì—­í• :** `my-web-service`ë¼ëŠ” ì´ë¦„ì˜ `Service`ë¥¼ ìƒì„± ì´ ì„œë¹„ìŠ¤ëŠ” `app: my-web`ì´ë¼ëŠ” ë¼ë²¨ì„ ê°€ì§„ Podë“¤(2ë‹¨ê³„ì—ì„œ ë§Œë“  NGINX Podë“¤)ì„ ì°¾ì•„ë‚´ê³ , ê·¸ë“¤ì—ê²Œ `80`ë²ˆ í¬íŠ¸ë¡œ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤ `type: ClusterIP`ëŠ” ì´ ì„œë¹„ìŠ¤ê°€ í´ëŸ¬ìŠ¤í„° ë‚´ë¶€ì—ì„œë§Œ ì‚¬ìš©ë¨ì„ ì˜ë¯¸

- **`web-service.yaml` íŒŒì¼ ì‘ì„±:**

  ```yaml
  apiVersion: v1
  kind: Service
  metadata:
    name: my-web-service
  spec:
    selector:
      app: my-web # ì´ ë¼ë²¨ì„ ê°€ì§„ Podì„ ì°¾ìŠµë‹ˆë‹¤.
    ports:
      - protocol: TCP
        port: 80 # ì„œë¹„ìŠ¤ ìì²´ì˜ í¬íŠ¸
        targetPort: 80 # Podì˜ ì»¨í…Œì´ë„ˆ í¬íŠ¸
    type: ClusterIP
  ```

- **íŒŒì¼ ì ìš©:**

```bash
kubectl apply -f web-service.yaml
```

<center><img src="https://image.minnnning.kr/images/2326fa85-5ab4-4c23-a269-8e493731649b.webp" style="zoom:50%;"></center>

&nbsp;

### 4. Ingress Controller ì„¤ì¹˜í•˜ê¸°

ì´ì œ ì™¸ë¶€ ìš”ì²­ì„ ë°›ì•„ì¤„ 'ê²½ë¹„ì›', ì¦‰ NGINX Ingress Controllerë¥¼ ì„¤ì¹˜í•œë‹¤

- **ëª…ë ¹ì–´ì˜ ì—­í• :** ì•„ë˜ `apply` ëª…ë ¹ì–´ëŠ” NGINX Ingress Controller ê³µì‹ GitHubì— ìˆëŠ” YAML íŒŒì¼ì„ í†µí•´ ì„¤ì¹˜ë¥¼ ì§„í–‰ ì´ íŒŒì¼ì€ `ingress-nginx` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê·¸ ì•ˆì— Controller `Deployment`, `Service`, ê°ì¢… ê¶Œí•œ ì„¤ì •(RBAC) ë“±ì„ ìë™ìœ¼ë¡œ ìƒì„±í•œë‹¤

- **ì„¤ì¹˜ ëª…ë ¹ì–´:**

  ```bash
  kubectl apply -f https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.10.1/deploy/static/provider/baremetal/deploy.yaml
  ```

- **ì™¸ë¶€ ì ‘ì† í¬íŠ¸ í™•ì¸:** ì„¤ì¹˜ í›„, `ingress-nginx` ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì˜ ì„œë¹„ìŠ¤ë¥¼ í™•ì¸í•˜ì—¬ ì™¸ë¶€ ì ‘ì† í¬íŠ¸(`NodePort`)ë¥¼ ì•Œì•„ë‚´ì•¼ í•œë‹¤(ìë™ ì„¤ì •í–ˆê¸° ë•Œë¬¸ì—)

  ```bash
  kubectl get service -n ingress-nginx
  ```

  <center><img src="https://image.minnnning.kr/images/1b7419c6-1083-4387-b055-36d4c9f2a096.webp" style="zoom:50%;"></center>

  ê²°ê³¼ì—ì„œ `ingress-nginx-controller` ì„œë¹„ìŠ¤ì˜ `PORT(S)` ë¶€ë¶„ì„ í™•ì¸ `80:32096/TCP` ì™€ ê°™ì´ í‘œì‹œëœ ë¶€ë¶„ì—ì„œ **32096**ê°€ ìš°ë¦¬ê°€ ì‚¬ìš©í•  í¬íŠ¸ ë²ˆí˜¸ì´ë‹¤ 32096ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ”ê²ƒì„ 80ìœ¼ë¡œ ë³´ë‚¸ë‹¤ ì˜ë¯¸

&nbsp;

### 5. ì•ˆë‚´íŒ ì„¸ìš°ê¸° (Ingress)

ë“œë””ì–´ "https://=hello.example.com:32096ìœ¼ë¡œ ì˜¨ ìš”ì²­ì€ my-web-serviceë¡œ ë³´ë‚´ë¼"ëŠ” ê·œì¹™ì„ ë‹´ì€ `Ingress` ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±

- **ëª…ë ¹ì–´ì˜ ì—­í• :** `my-web-ingress`ë¼ëŠ” ì´ë¦„ì˜ `Ingress`ë¥¼ ìƒì„± `ingressClassName: nginx`ëŠ” ì´ ê·œì¹™ì„ NGINX Ingress Controllerê°€ ì²˜ë¦¬í•´ì•¼ í•¨ì„ ëª…ì‹œí•œë‹¤ `host`ì™€ `path` ê·œì¹™ì— ë”°ë¼ ë“¤ì–´ì˜¨ ìš”ì²­ì„ `my-web-service`ì˜ `80`ë²ˆ í¬íŠ¸ë¡œ ì „ë‹¬

- **`web-ingress.yaml` íŒŒì¼ ì‘ì„±:**

  ```yaml
  apiVersion: networking.k8s.io/v1
  kind: Ingress
  metadata:
    name: my-web-ingress
  spec:
    ingressClassName: nginx # NGINX Ingress Controllerë¥¼ ì‚¬ìš©
    rules:
    - host: "hello.example.com"
      http:
        paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: my-web-service # 3ë‹¨ê³„ì—ì„œ ë§Œë“  ì„œë¹„ìŠ¤ ì´ë¦„
              port:
                number: 80 # ì„œë¹„ìŠ¤ì˜ í¬íŠ¸ ë²ˆí˜¸
  ```

- **íŒŒì¼ ì ìš©:**

```bash
kubectl apply -f web-ingress.yaml
```

<center><img src="https://image.minnnning.kr/images/3f2492a5-3fa0-47a2-a58d-8f74cc2d282e.webp" style="zoom:50%;"></center>

&nbsp;

### 6. ì™¸ë¶€ì™€ ì—°ê²°í•˜ê¸° (`hosts` íŒŒì¼ ìˆ˜ì •)

ë§ˆì§€ë§‰ìœ¼ë¡œ, ë‚´ ì»´í“¨í„°ì˜ ì›¹ ë¸Œë¼ìš°ì €ê°€ `hello.example.com`ì´ë¼ëŠ” ë„ë©”ì¸ì„ ì–´ë””ë¡œ ì°¾ì•„ê°€ì•¼ í• ì§€ ì•Œë ¤ì¤˜ì•¼ í•œë‹¤ ì¸í„°ë„·ì—ëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì£¼ì†Œì´ë¯€ë¡œ, ë‚´ ì»´í“¨í„°ì˜ `hosts` íŒŒì¼ì„ ìˆ˜ì •í•˜ì—¬ ì§ì ‘ ì§€ì •

- **ëª…ë ¹ì–´ì˜ ì—­í• :** `hosts` íŒŒì¼ì— `<ì›Œì»¤ë…¸ë“œ_IP> hello.example.com` ë¼ì¸ì„ ì¶”ê°€í•˜ë©´, ë‚´ ì»´í“¨í„°ëŠ” ì´ ë„ë©”ì¸ì— ëŒ€í•œ ìš”ì²­ì„ ì¸í„°ë„· DNSì— ë¬»ì§€ ì•Šê³  ì§€ì •ëœ IPë¡œ ì¦‰ì‹œ ë³´ë‚¸ë‹¤

- **ìˆ˜ì • ë°©ë²•:**

  1. **ì›Œì»¤ ë…¸ë“œ IP í™•ì¸:** `kubectl get nodes -o wide` ëª…ë ¹ì–´ë¡œ ì›Œì»¤ ë…¸ë“œ ì¤‘ í•˜ë‚˜ì˜ `INTERNAL-IP`ë¥¼ í™•ì¸
     <center><img src="https://image.minnnning.kr/images/4243bc85-c284-4d3e-acb1-8343236f7a4d.webp" style="zoom:50%;"></center>
  
  2. **`hosts` íŒŒì¼ ì—´ê¸°:** ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ íŒŒì¼ì—°ë‹¤
  
     - **Linux / macOS:** `sudo nano /etc/hosts`
     - **Windows:** ë©”ëª¨ì¥ì„ 'ê´€ë¦¬ì ê¶Œí•œìœ¼ë¡œ ì‹¤í–‰'í•œ í›„ `C:\Windows\System32\drivers\etc\hosts` íŒŒì¼ ìˆ˜ì •

  3. **ë‚´ìš© ì¶”ê°€:** íŒŒì¼ ë§¨ ì•„ë˜ì— ë‹¤ìŒ ë¼ì¸ì„ ì¶”ê°€í•˜ê³  ì €ì¥ `<ì›Œì»¤ë…¸ë“œ_IP>` ë¶€ë¶„ì€ 1ë²ˆì—ì„œ í™•ì¸í•œ ì‹¤ì œ IPë¡œ ë³€ê²½í•´ì•¼ í•œë‹¤
  
     ```bash
     <ì›Œì»¤ë…¸ë“œ_IP>  hello.example.com
     # ì˜ˆì‹œ: 192.168.56.11  hello.example.com
     ```

&nbsp;

### ìµœì¢… í™•ì¸

ì´ì œ ì›¹ ë¸Œë¼ìš°ì €ë¥¼ ì—´ê³  ì£¼ì†Œì°½ì— ì•„ë˜ ì£¼ì†Œë¥¼ ì…ë ¥

> [**http://hello.example.com:32096**](https://www.google.com/search?q=http://hello.example.com)

<center><img src="https://image.minnnning.kr/images/a80b69dd-1044-423b-860f-55ffa0d38d72.webp" style="zoom:50%;"></center>
